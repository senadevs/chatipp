import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.C-1C7K5d.js";import{u as H,a as G,c as i,B as f}from"./button.DB3euxDd.js";import{I as O}from"./input.D_t8jYCD.js";import{g as K,h as T,M as Y,r as _,a as $,B as q,b as U,c as V,d as W,P as I,S as J,C as Q,H as X,t as Z,F as D,e as ee,f as se,I as te}from"./hover-card.CxF68cKK.js";import{a as ae,C as re}from"./index.CmoEq9BJ.js";import"./index.BeJBZjGA.js";import"./index.DogxjsyZ.js";import"./createLucideIcon.CXgODOBx.js";const ne=[{value:"gpt-4",label:"GPT-4",description:"Most capable model, best for complex tasks",icon:"âœ¨"},{value:"gpt-3.5-turbo",label:"GPT-3.5",description:"Fast and efficient for most tasks",icon:"âš¡"},{value:"gemini-pro",label:"Gemini",description:"Google's most advanced AI model",icon:"ðŸŒŸ"},{value:"claude-3",label:"Claude 3",description:"Exceptional at analysis and writing",icon:"ðŸŽ¯"},{value:"mistral-large",label:"Mistral",description:"Open-source model with strong capabilities",icon:"ðŸš€"},{value:"mixtral-8x7b",label:"Mixtral",description:"Powerful open-source mixture of experts",icon:"ðŸ”®"}],le=({language:t,children:l})=>{const[d,m]=n.useState(!1),j=()=>{navigator.clipboard.writeText(l),m(!0),setTimeout(()=>m(!1),2e3)};return e.jsxs("div",{className:"relative group",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:j,children:d?e.jsx(re,{className:"h-4 w-4 text-green-500"}):e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(X,{theme:Z.nightOwl,code:l.trim(),language:t||"text",children:({className:u,style:N,tokens:x,getLineProps:b,getTokenProps:v})=>e.jsxs("pre",{className:"overflow-x-auto p-4 rounded-lg",style:{...N,backgroundColor:"var(--code-bg)",marginTop:"1rem",marginBottom:"1rem"},children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{style:{color:"var(--code-meta)",fontSize:"0.875rem"},children:t})}),x.map((h,p)=>e.jsxs("div",{...b({line:h}),style:{display:"table-row"},children:[e.jsx("span",{style:{display:"table-cell",paddingRight:"1rem",color:"var(--code-line-number)",userSelect:"none",width:"1%",whiteSpace:"nowrap"},children:p+1}),e.jsx("span",{style:{display:"table-cell"},children:h.map((g,w)=>e.jsx("span",{...v({token:g})},w))})]},p))]})})]})},oe=({file:t,type:l})=>{const d={image:e.jsx(te,{className:"h-5 w-5"}),"application/pdf":e.jsx(D,{className:"h-5 w-5"}),video:e.jsx(se,{className:"h-5 w-5"}),audio:e.jsx(ee,{className:"h-5 w-5"})}[l.split("/")[0]]||e.jsx(I,{className:"h-5 w-5"});return e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-md bg-muted",children:[d,e.jsx("span",{className:"text-sm truncate max-w-[200px]",children:t.name})]})},ie=({attachment:t})=>{switch(t.type){case"image":return e.jsx("div",{className:"mt-2 rounded-lg overflow-hidden max-w-sm",children:e.jsx("img",{src:t.url,alt:"attachment",className:"w-full h-auto"})});case"pdf":return e.jsx("div",{className:"mt-2",children:e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 rounded-md bg-muted hover:bg-muted/80 transition-colors",children:[e.jsx(D,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:t.name})]})});case"video":return e.jsx("div",{className:"mt-2 max-w-sm",children:e.jsxs("video",{controls:!0,className:"w-full rounded-lg",children:[e.jsx("source",{src:t.url,type:"video/mp4"}),"Your browser does not support the video tag."]})});case"audio":return e.jsx("div",{className:"mt-2",children:e.jsxs("audio",{controls:!0,className:"w-full",children:[e.jsx("source",{src:t.url,type:"audio/mpeg"}),"Your browser does not support the audio tag."]})});default:return null}};function je({isPublic:t=!1}){const[l,d]=n.useState([]),[m,j]=n.useState(""),[u,N]=n.useState(!1),[x,b]=n.useState([]),v=n.useRef(null),{toast:h}=H(),p=n.useRef(null),{isAuthenticated:g}=G(),[w,E]=n.useState(null),[S,C]=n.useState("chat"),[F,B]=n.useState("gpt-4"),L=()=>{p.current&&p.current.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{L()},[l]);const R=s=>{if(!g){h({title:"Authentication Required",description:"Please login to send files",variant:"destructive"});return}const a=Array.from(s.target.files||[]);if(a.reduce((o,c)=>o+c.size,0)>50*1024*1024){h({title:"Error",description:"Total file size cannot exceed 50MB",variant:"destructive"});return}b(o=>[...o,...a])},k=async()=>{if(!m.trim()&&x.length===0)return;const s=new FormData;s.append("message",m.trim()),g&&x.forEach(r=>s.append("files",r));const a={id:Date.now().toString(),content:m.trim(),sender:"user",timestamp:new Date,attachments:g?x.map(r=>({type:r.type.split("/")[0],url:URL.createObjectURL(r),name:r.name})):void 0};d(r=>[...r,a]),j(""),b([]);try{const o=await(await fetch("/api/chat",{method:"POST",body:s})).json(),c={id:(Date.now()+1).toString(),content:o.message||"Lo siento, hubo un error en la respuesta.",sender:"bot",timestamp:new Date};d(y=>[...y,c])}catch{const o={id:(Date.now()+1).toString(),content:"Lo siento, hubo un error en la conexiÃ³n.",sender:"bot",timestamp:new Date};d(c=>[...c,o])}},z=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),k())},A=s=>{E(s);const a=document.getElementById(`message-${s}`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.classList.add("bg-accent/50"),setTimeout(()=>{a.classList.remove("bg-accent/50")},2e3))};return e.jsxs("div",{className:"h-[calc(100vh-8rem)] w-full flex bg-background relative rounded-lg border",children:[e.jsx("div",{className:i("bg-card border-r border-border transition-all duration-300 ease-in-out",u?"w-12":"w-64","relative h-full"),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[e.jsx("h2",{className:i("font-semibold text-sm",u&&"hidden"),children:"Chat History"}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>N(!u),className:"h-8 w-8",children:u?e.jsx(ae,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})]}),e.jsx(T,{className:"flex-1",children:e.jsxs("div",{className:"p-2 space-y-1",children:[l.map(s=>e.jsx(f,{variant:"ghost",className:i("w-full justify-start text-left p-2 h-auto",u&&"hidden",w===s.id&&"bg-accent"),onClick:()=>A(s.id),children:e.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:s.timestamp.toLocaleTimeString()}),e.jsx("span",{className:"text-xs font-medium",children:s.sender==="user"?"You":"Bot"})]}),e.jsxs("p",{className:"text-sm truncate",children:[s.content.substring(0,30),s.content.length>30&&"..."]})]})},s.id)),l.length===0&&e.jsx("p",{className:i("text-sm text-muted-foreground p-2",u&&"hidden"),children:"No messages yet"})]})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(T,{className:"flex-1 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto py-4 space-y-6",children:[l.length===0&&e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"Welcome to the chat!"}),e.jsx("p",{className:"text-sm",children:"Start a conversation by sending a message."})]}),l.map(s=>e.jsx("div",{id:`message-${s.id}`,className:i("flex w-full transition-colors duration-300 rounded-lg p-2",s.sender==="user"?"justify-end":"justify-start"),children:e.jsxs("div",{className:i("rounded-lg px-4 py-2 max-w-[90%] transition-all",s.sender==="user"?"bg-primary text-primary-foreground":"bg-muted"),children:[s.sender==="bot"?e.jsx("div",{className:"markdown-content",children:e.jsx(Y,{remarkPlugins:[_],components:{code:({node:a,inline:r,className:o,children:c,...y})=>{if(r)return e.jsx("code",{className:"bg-muted px-1.5 py-0.5 rounded-md text-sm",...y,children:c});const M=/language-(\w+)/.exec(o||""),P=M?M[1]:"text";return e.jsx(le,{language:P,children:String(c).replace(/\n$/,"")})}},children:s.content})}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm break-words",children:s.content}),s.attachments?.map((a,r)=>e.jsx(ie,{attachment:a},r))]}),e.jsx("span",{className:"text-xs opacity-50 mt-1 block",children:s.timestamp.toLocaleTimeString()})]})},s.id)),e.jsx("div",{ref:p})]})}),e.jsx("div",{className:"p-4 border-t border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map((s,a)=>e.jsx(oe,{file:s,type:s.type},a))}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"relative inline-flex h-9 rounded-full border bg-muted p-1 hover:bg-muted/80",children:[e.jsx("button",{className:i("relative inline-flex items-center gap-2 rounded-full px-3 text-sm transition-colors",S==="chat"?"bg-background text-foreground shadow-sm":"text-muted-foreground"),onClick:()=>C("chat"),children:e.jsx($,{className:"h-4 w-4"})}),e.jsx("button",{className:i("relative inline-flex items-center gap-2 rounded-full px-3 text-sm transition-colors",S==="agent"?"bg-background text-foreground shadow-sm":"text-muted-foreground"),onClick:()=>C("agent"),children:e.jsx(q,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(s=>e.jsxs(U,{children:[e.jsx(V,{asChild:!0,children:e.jsxs("button",{onClick:()=>B(s.value),className:i("inline-flex items-center justify-center rounded-full px-3 py-1 text-sm transition-colors",F===s.value?"bg-primary text-primary-foreground shadow-sm":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[e.jsx("span",{className:"mr-1",children:s.icon}),s.label]})}),e.jsx(W,{className:"w-64",children:e.jsx("div",{className:"flex justify-between space-x-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold",children:s.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})})})]},s.value))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{placeholder:t?"Send a message as guest...":"Type a message...",value:m,onChange:s=>j(s.target.value),onKeyDown:z,className:"flex-1"}),!t&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:v,onChange:R,multiple:!0,accept:"image/*,application/pdf,video/*,audio/*",className:"hidden"}),e.jsx(f,{variant:"outline",size:"icon",onClick:()=>v.current?.click(),children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsx(f,{onClick:k,size:"icon",children:e.jsx(J,{className:"h-4 w-4"})})]}),t&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[e.jsx("a",{href:"/login",className:"text-primary hover:underline",children:"Sign in"})," ","to send files and access all features"]})]})})]})]})}export{je as default};
